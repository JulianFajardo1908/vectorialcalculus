---
title: "Curvas parametrizadas en R"
author: "Julián Fajardo & Col."
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)
library(plotly)

# 1) Intenta cargar tu paquete (ajusta el nombre si es otro)
pkg <- "vectorialcalculus"
if (requireNamespace(pkg, quietly = TRUE)) {
  library(pkg, character.only = TRUE)
}

# 2) Si estás en desarrollo, intenta sourcear los .R (ajusta rutas)
# try(source("R/frenet_frame3d.R"), silent = TRUE)
# try(source("R/osculating_ribbon3d.R"), silent = TRUE)
# try(source("R/arc_length3d.R"), silent = TRUE)

has_fn <- function(fname, pkg = NULL) {
  if (!is.null(pkg) && requireNamespace(pkg, quietly = TRUE)) {
    exists(fname, where = asNamespace(pkg), inherits = FALSE)
  } else {
    exists(fname, mode = "function", inherits = TRUE)
  }
}

# Wrappers "seguros" que no rompen el knit si falta la función real
arc_length3d_safe <- function(X, Y, Z, a, b, ...) {
  if (has_fn("arc_length3d", pkg)) {
    get("arc_length3d", envir = asNamespace(pkg))(X, Y, Z, a, b, ...)
  } else if (has_fn("arc_length3d")) {
    arc_length3d(X, Y, Z, a, b, ...)
  } else {
    t <- seq(a, b, length.out = 300)
    plot_ly(x=~X(t), y=~Y(t), z=~Z(t),
            type="scatter3d", mode="lines") |>
      layout(title = "Demo: curva (no está arc_length3d)")
  }
}

frenet_frame3d_safe <- function(X, Y, Z, a, b, t_points=NULL, ...) {
  if (has_fn("frenet_frame3d", pkg)) {
    get("frenet_frame3d", envir = asNamespace(pkg))(X, Y, Z, a, b, t_points=t_points, ...)
  } else if (has_fn("frenet_frame3d")) {
    frenet_frame3d(X, Y, Z, a, b, t_points=t_points, ...)
  } else {
    t <- seq(a, b, length.out = 600)
    plot_ly(x=~X(t), y=~Y(t), z=~Z(t),
            type="scatter3d", mode="lines") |>
      layout(title = "Demo: Lissajous (falta frenet_frame3d)")
  }
}

osculating_ribbon3d_safe <- function(X, Y, Z, a, b, ...) {
  if (has_fn("osculating_ribbon3d", pkg)) {
    get("osculating_ribbon3d", envir = asNamespace(pkg))(X, Y, Z, a, b, ...)
  } else if (has_fn("osculating_ribbon3d")) {
    osculating_ribbon3d(X, Y, Z, a, b, ...)
  } else {
    t <- seq(a, b, length.out = 800)
    plot_ly(x=~X(t), y=~Y(t), z=~Z(t),
            type="scatter3d", mode="lines") |>
      layout(title = "Demo: nudo trébol (falta osculating_ribbon3d)")
  }
}
```

## 1) Longitud de arco — Hélice simple

La curva
\[
\mathbf{r}(t)=(\cos t,\ \sin t,\ t),\; t\in[0,2\pi].
\]

```{r}
arc_length3d_safe(
  X=function(t) cos(t),
  Y=function(t) sin(t),
  Z=function(t) t,
  a=0, b=2*pi,
  plot=TRUE
)
```

## 2) Marco de Frenet–Serret — Lissajous (3,4,5)

La curva
\[
\mathbf{r}(t)=(\sin 3t,\ \sin 4t,\ \sin 5t),\; t\in[0,2\pi].
\]

```{r}
frenet_frame3d_safe(
  X=function(t) sin(3*t),
  Y=function(t) sin(4*t),
  Z=function(t) sin(5*t),
  a=0, b=2*pi,
  t_points=c(pi/3, pi, 5*pi/3),
  plot=TRUE,
  n_samples=500,
  T_line=list(color="red", width=5),
  N_line=list(color="green", width=5),
  B_line=list(color="black", width=5)
)
```

## 3) Cinta osculadora — Nudo trébol

La curva
\[
\mathbf{r}(t)=(\sin t+2\sin 2t,\ \cos t-2\cos 2t,\ -\sin 3t),\; t\in[0,2\pi].
\]

```{r}
osculating_ribbon3d_safe(
  X=function(t) sin(t) + 2*sin(2*t),
  Y=function(t) cos(t) - 2*cos(2*t),
  Z=function(t) -sin(3*t),
  a=0, b=2*pi,
  plot=TRUE
)
```
