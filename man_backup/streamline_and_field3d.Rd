% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/streamline_and_field3d.R
\name{streamline_and_field3d}
\alias{streamline_and_field3d}
\title{Vector field + streamline in 3D (single combined figure)}
\usage{
streamline_and_field3d(
  F,
  H1,
  H2,
  G1,
  G2,
  a,
  b,
  NX = 8,
  NY = 6,
  NZ = 6,
  p,
  T,
  step,
  arrows = c("both", "line", "cone", "none"),
  arrow_scale = 0.08,
  normalize_bias = 1,
  normal_color = "rgba(0,0,0,0.55)",
  normal_width = 2,
  arrow_color = "#1d3557",
  arrow_opacity = 0.95,
  arrow_size = 0.35,
  traj_color = "#e63946",
  traj_width = 5,
  traj_markers = TRUE,
  traj_marker_size = 2,
  scene = list(aspectmode = "data", xaxis = list(title = "x"), yaxis = list(title = "y"),
    zaxis = list(title = "z")),
  bg = list(paper = "white", plot = "white")
)
}
\arguments{
\item{F}{\code{function(x,y,z)} or \code{function(x,y,z,t)} returning \code{c(Fx,Fy,Fz)}.
If it includes \code{t}, the time dependence is used in the integration.}

\item{H1, H2}{\code{function(x)}: lower/upper limits in \eqn{y}.}

\item{G1, G2}{\code{function(x,y)}: lower/upper limits in \eqn{z}.}

\item{a, b}{Domain limits in \eqn{x} (\code{b > a}).}

\item{NX, NY, NZ}{Integers \eqn{\ge 1}: sampling density of the field in \eqn{i,j,k}
(evaluates \code{(NX+1)\times(NY+1)\times(NZ+1)} points).}

\item{p}{Streamline initial point \code{c(x0,y0,z0)}.}

\item{T, step}{Final time and RK4 step. If \code{T<0}, integrates backward.}

\item{arrows}{Arrow mode: \code{"none"}, \code{"line"}, \code{"cone"} or \code{"both"}.}

\item{arrow_scale}{Global arrow length scale (fraction of the largest span of the bounding box).}

\item{normalize_bias}{Saturation bias for the field magnitude:
uses \eqn{\tilde F = F / \sqrt{\|F\|^2 + \texttt{bias}}}. Default \code{1}.}

\item{normal_color, normal_width}{Color and width of the arrow \emph{shaft} (line).}

\item{arrow_color, arrow_opacity, arrow_size}{Color, opacity and relative size of the head
(cone if available; otherwise chevron).}

\item{traj_color, traj_width}{Streamline color and width.}

\item{traj_markers, traj_marker_size}{Whether to show markers on the streamline and their size.}

\item{scene}{List of 3D scene settings (e.g., \code{aspectmode="data"}, axis titles).}

\item{bg}{Background colors: list with \code{paper} and \code{plot}.}
}
\value{
A list with:
\itemize{
\item \code{field_points}: \code{data.frame} with \code{x,y,z,mag} at arrow bases,
\item \code{field_segments}: \code{data.frame} with \code{x0,y0,z0,x1,y1,z1} for arrow shafts,
\item \code{traj}: \code{data.frame} with the trajectory (\code{t,x,y,z,speed}),
\item \code{fig}: \pkg{plotly} object with field + streamline.
}
}
\description{
Plots the 3D vector field \eqn{\mathbf F(x,y,z)} over a curvilinear volume and
overlays the \strong{streamline} \eqn{\mathbf r'(t)=\mathbf F(\mathbf r(t),t)}
with \eqn{\mathbf r(0)=\mathbf p}, integrated by fixed–step \strong{RK4} in a
\emph{single} \pkg{plotly} figure.
}
\details{
The volume is defined by linear blends:
\deqn{
\begin{aligned}
x &= (1-i)\,a + i\,b,\quad i\in[0,1],\\
y &= (1-j)\,H_1(x) + j\,H_2(x),\quad j\in[0,1],\\
z &= (1-k)\,G_1(x,y) + k\,G_2(x,y),\quad k\in[0,1].
\end{aligned}
}

If your \pkg{plotly} has \code{add_cone()}, arrowheads are drawn as \emph{cones};
otherwise a \emph{chevron} (two segments forming a “V”) is used as a fallback.
\itemize{
\item Arrow length scales with a \emph{saturated} version of \eqn{\|\mathbf F\|}:
normalize with \code{normalize_bias}, then \eqn{L \propto \|\tilde{\mathbf F}\|}.
\item If the plot looks cluttered, reduce \code{NX,NY,NZ} or \code{arrow_scale}.
\item If the streamline does not stand out, increase \code{traj_width} or change \code{traj_color}.
}
}
\examples{
\dontshow{if (interactive()) \{}
H1 <- function(x) -1; H2 <- function(x) 1
G1 <- function(x,y) -0.5; G2 <- function(x,y) 0.5
F  <- function(x,y,z) c(-y, x, 0.6)
streamline_and_field3d(
  F, H1, H2, G1, G2,
  a = -2, b = 2, NX = 10, NY = 8, NZ = 5,
  p = c(1,0,0), T = 12, step = 0.02,
  arrows = "both", arrow_scale = 0.12, normalize_bias = 1,
  normal_color = "rgba(0,0,0,0.55)", normal_width = 2,
  arrow_color  = "#1d3557", arrow_opacity = 0.95, arrow_size = 0.4,
  traj_color   = "#e63946", traj_width = 5, traj_markers = TRUE
)
\dontshow{\}}

}
